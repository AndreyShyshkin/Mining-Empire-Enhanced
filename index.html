<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Mining Empire Enhanced</title>
		<link rel="stylesheet" href="style.css" />
		<link rel="stylesheet" href="css/friends.css" />
		<link rel="stylesheet" href="css/multiplayer.css" />
		<link rel="stylesheet" href="css/inventory-tooltip.css" />
		<link rel="stylesheet" href="css/settings-menu.css" />
		<script type="module">
			// Import the functions you need from the SDKs you need
			import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js'
			import {
				getAuth,
				GoogleAuthProvider,
				signInWithPopup,
				createUserWithEmailAndPassword,
				signInWithEmailAndPassword,
				signOut,
				onAuthStateChanged,
				updateProfile,
				updatePassword,
				updateEmail,
				reauthenticateWithCredential,
				EmailAuthProvider,
			} from 'https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js'
			import {
				getDatabase,
				ref,
				set,
				get,
				child,
				update,
				remove,
				onValue,
				onChildAdded,
				onChildChanged,
				onChildRemoved,
				off,
				onDisconnect,
			} from 'https://www.gstatic.com/firebasejs/11.7.3/firebase-database.js'

			// Your web app's Firebase configuration
			const firebaseConfig = {
				apiKey: 'AIzaSyDCYUHZa1XuEH1fky3WkgOkWdvH79TdfXE',
				authDomain: 'mining-empire-enhanced.firebaseapp.com',
				databaseURL:
					'https://mining-empire-enhanced-default-rtdb.europe-west1.firebasedatabase.app',
				projectId: 'mining-empire-enhanced',
				storageBucket: 'mining-empire-enhanced.firebasestorage.app',
				messagingSenderId: '287033597190',
				appId: '1:287033597190:web:529a88526cef2040b05287',
			}

			// Initialize Firebase
			const app = initializeApp(firebaseConfig)
			const auth = getAuth(app)
			const database = getDatabase(app)

			// Export for other modules
			window.firebaseApp = app
			window.firebaseAuth = auth
			window.firebaseDatabase = database
			window.firebaseConfig = firebaseConfig
			window.GoogleAuthProvider = GoogleAuthProvider
			window.EmailAuthProvider = EmailAuthProvider
			window.signInWithPopup = signInWithPopup
			window.createUserWithEmailAndPassword = createUserWithEmailAndPassword
			window.signInWithEmailAndPassword = signInWithEmailAndPassword
			window.signOutFirebase = signOut
			window.onAuthStateChanged = onAuthStateChanged
			window.updateProfile = updateProfile
			window.updatePassword = updatePassword
			window.updateEmail = updateEmail
			window.reauthenticateWithCredential = reauthenticateWithCredential
			window.dbRef = ref
			window.dbSet = set
			window.dbGet = get
			window.dbChild = child
			window.dbUpdate = update
			window.dbRemove = remove
			window.dbOnValue = onValue
			window.dbOnChildAdded = onChildAdded
			window.dbOnChildChanged = onChildChanged
			window.dbOnChildRemoved = onChildRemoved
			window.dbOff = off
			window.dbOnDisconnect = onDisconnect
		</script>
	</head>
	<body>
		<div id="authContainer" class="auth-container">
			<div id="authForm">
				<h2 id="authTitle">Login</h2>
				<input type="email" id="emailInput" placeholder="Email" />
				<input type="password" id="passwordInput" placeholder="Password" />
				<button id="emailPasswordAuthButton">Login</button>
				<button id="googleAuthButton">Login with Google</button>
				<p id="authToggleText">
					Don't have an account? <a href="#" id="toggleToRegister">Register</a>
				</p>
				<p id="authError" class="error-message"></p>
			</div>
			<div id="userInfo" style="display: none">
				<p>Welcome, <span id="userName"></span>!</p>
				<button id="profileButton" class="menu-button">Профиль</button>
				<button id="logoutButton">Logout</button>
			</div>
		</div>

		<!-- Главный экран -->
		<div id="mainMenu" class="main-menu">
			<div class="menu-container">
				<h1 class="game-title">Mining Empire Enhanced</h1>

				<div class="user-panel">
					<p id="menuUserName" class="user-welcome">Привет, гость</p>
				</div>

				<div class="menu-buttons">
					<button id="newWorldBtn" class="menu-button">Новый мир</button>
					<button id="loadWorldBtn" class="menu-button">Загрузить мир</button>
					<button id="multiplayerBtn" class="menu-button">Мультиплеер</button>
					<button id="friendsBtn" class="menu-button">Друзья</button>
					<button id="settingsBtn" class="menu-button">Настройки</button>
					<button id="profileMenuBtn" class="menu-button">Профиль</button>
					<button id="logoutMenuBtn" class="menu-button warning">Выйти</button>
				</div>

				<!-- Панель создания нового мира -->
				<div id="newWorldPanel" class="menu-panel">
					<h2>Создать новый мир</h2>
					<div class="form-group">
						<label for="worldName">Название мира:</label>
						<input type="text" id="worldName" placeholder="Мой мир" />
					</div>
					<div class="form-group">
						<label for="worldSize">Размер мира:</label>
						<select id="worldSize">
							<option value="small">Маленький</option>
							<option value="medium" selected>Средний</option>
							<option value="large">Большой</option>
						</select>
					</div>
					<div class="form-buttons">
						<button id="createWorldBtn" class="menu-button">Создать</button>
						<button id="backFromNewBtn" class="menu-button secondary">
							Назад
						</button>
					</div>
				</div>

				<!-- Панель загрузки мира -->
				<div id="loadWorldPanel" class="menu-panel">
					<h2>Загрузить мир</h2>
					<div id="worldsList" class="worlds-list">
						<!-- Здесь будут отображаться сохраненные миры -->
					</div>
					<div class="form-buttons">
						<button id="backFromLoadBtn" class="menu-button secondary">
							Назад
						</button>
					</div>
				</div>

				<!-- Панель настроек -->
				<div id="settingsPanel" class="menu-panel">
					<h2>Настройки</h2>
					<div class="form-group">
						<label for="soundVolume">Громкость звука:</label>
						<input type="range" id="soundVolume" min="0" max="100" value="50" />
					</div>
					<div class="form-group">
						<label for="renderDistance">Дальность прорисовки:</label>
						<select id="renderDistance">
							<option value="10">Низкая</option>
							<option value="20" selected>Средняя</option>
							<option value="30">Высокая</option>
						</select>
					</div>
					<div class="form-buttons">
						<button id="saveSettingsBtn" class="menu-button">Сохранить</button>
						<button id="backFromSettingsBtn" class="menu-button secondary">
							Назад
						</button>
					</div>
				</div>

				<!-- Панель друзей -->
				<div id="friendsPanel" class="menu-panel">
					<h2>Друзья</h2>

					<!-- Поиск друзей -->
					<div class="friends-search">
						<h3>Найти друзей</h3>
						<div class="form-group">
							<input
								type="text"
								id="friendSearchInput"
								placeholder="Email или имя пользователя"
							/>
							<button id="searchFriendBtn" class="menu-button small">
								Поиск
							</button>
						</div>
						<div id="searchResults" class="friends-section"></div>
					</div>

					<!-- Запросы в друзья -->
					<div class="friends-requests">
						<h3>
							Запросы в друзья <span id="requestsCount" class="badge">0</span>
						</h3>
						<div id="friendRequests" class="friends-section">
							<p class="empty-list">У вас нет новых запросов в друзья</p>
						</div>
					</div>

					<!-- Список друзей -->
					<div class="friends-list-container">
						<h3>Ваши друзья <span id="friendsCount" class="badge">0</span></h3>
						<div id="friendsList" class="friends-section">
							<p class="empty-list">У вас пока нет друзей</p>
						</div>
					</div>

					<div class="form-buttons">
						<button id="backFromFriendsBtn" class="menu-button secondary">
							Назад
						</button>
					</div>
				</div>

				<!-- Панель мультиплеера -->
				<div id="multiplayerPanel" class="menu-panel multiplayer-panel">
					<h2>Мультиплеер</h2>

					<!-- Создание игры -->
					<div class="multiplayer-section create-game-section">
						<h3>Создать новую игру</h3>
						<div class="form-group">
							<label for="useExistingWorldMP"
								>Использовать существующий мир:</label
							>
							<select id="useExistingWorldMP">
								<option value="new" selected>Создать новый мир</option>
								<!-- Существующие миры будут загружены здесь -->
							</select>
						</div>
						<div class="form-group" id="newWorldSettingsMP">
							<label for="worldNameMP">Название мира:</label>
							<input
								type="text"
								id="worldNameMP"
								placeholder="Мультиплеер мир"
							/>
						</div>
						<div class="form-group" id="worldSizeSettingMP">
							<label for="worldSizeMP">Размер мира:</label>
							<select id="worldSizeMP">
								<option value="small">Маленький</option>
								<option value="medium" selected>Средний</option>
								<option value="large">Большой</option>
							</select>
						</div>
						<div class="form-buttons">
							<button id="createGameBtn" class="menu-button">
								Создать игру
							</button>
						</div>
					</div>

					<!-- Присоединиться к игре -->
					<div class="multiplayer-section join-game-section">
						<h3>Активные игры</h3>
						<div id="activeGamesContainer" class="active-games-container">
							<!-- Здесь будут отображаться активные игры -->
						</div>
						<p
							id="noGamesMessage"
							class="no-games-message"
							style="display: none"
						>
							Нет активных игр
						</p>
						<div class="form-buttons">
							<button id="refreshGamesBtn" class="menu-button">
								Обновить список
							</button>
						</div>
					</div>

					<div class="form-buttons">
						<button id="backFromMultiplayerBtn" class="menu-button secondary">
							Назад
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Игровой контейнер (скрыт изначально) -->
		<div id="gameContainer" class="game-container" style="display: none">
			<canvas id="gameCanvas"></canvas>
			<div class="ui-container">
				<div class="inventory-bar" id="inventoryBar"></div>
				<div class="player-stats">
					<div class="health-bar">
						<div class="health-fill" id="healthFill"></div>
					</div>
				</div>
			</div>
			<button id="returnToMenuBtn" class="menu-button return-button">
				Меню
			</button>

			<!-- Статус мультиплеера -->
			<div
				id="multiplayerStatusBar"
				class="multiplayer-status-bar"
				style="display: none"
			>
				<h4>Игроки онлайн</h4>
				<ul id="playersList" class="players-list">
					<!-- Здесь будут отображаться игроки -->
				</ul>
			</div>
		</div>

		<div
			id="profilePanel"
			class="auth-container profile-panel"
			style="display: none"
		>
			<h2>Профиль пользователя</h2>
			<div class="form-group">
				<label for="profileDisplayName">Имя:</label>
				<input
					type="text"
					id="profileDisplayName"
					placeholder="Имя пользователя"
				/>
			</div>
			<div class="form-group">
				<label for="profileEmail">Email:</label>
				<input type="email" id="profileEmail" placeholder="Email" readonly />
			</div>
			<div class="form-group">
				<label for="profileNewPassword">Новый пароль:</label>
				<input
					type="password"
					id="profileNewPassword"
					placeholder="Оставьте пустым, чтобы не менять"
				/>
			</div>
			<div class="form-group">
				<label for="profileConfirmPassword">Подтвердите пароль:</label>
				<input
					type="password"
					id="profileConfirmPassword"
					placeholder="Подтвердите новый пароль"
				/>
			</div>
			<button id="saveProfileButton" class="menu-button">
				Сохранить изменения
			</button>
			<button id="closeProfileButton" class="menu-button secondary">
				Закрыть
			</button>
			<p id="profileMessage" class="message"></p>
		</div>

		<script src="js/utils.js"></script>
		<script src="js/crafting.js"></script>
		<script src="js/crafting-system-fix.js"></script>
		<script src="js/blocks.js"></script>
		<script src="js/renderer.js"></script>
		<script src="js/inventory-css.js"></script>
		<script src="js/inventory.js"></script>
		<script src="js/inventory-sync.js"></script>
		<script src="js/crafting-css.js"></script>
		<script src="js/crafting-ui.js"></script>
		<script src="js/crafting-ui-fixed.js"></script>
		<script src="js/crafting-ui-rewrite.js"></script>
		<script src="js/crafting-fix.js"></script>
		<script src="js/crafting-connector.js"></script>
		<script src="js/crafting-button-fix.js"></script>
		<script src="js/emergency-crafting-fix.js"></script>
		<script src="js/ultimate-crafting-fix.js"></script>
		<script src="js/offline-crafting-fix.js"></script>
		<script src="js/comprehensive-offline-crafting-fix.js"></script>
		<script src="js/critical-offline-crafting-fix.js"></script>
		<script src="js/auto-crafting-init.js"></script>
		<script src="js/player.js"></script>
		<script src="js/mining-system-fix.js"></script>
		<script src="js/tool-progression-fix.js"></script>
		<script src="js/worldManager.js"></script>
		<script src="js/world.js"></script>
		<script src="js/menu.js"></script>
		<script src="js/game.js"></script>
		<script src="js/game-crafting-init-fix.js"></script>
		<script src="js/firebase-auth.js"></script>
		<script src="js/friends.js"></script>
		<script src="js/multiplayer.js"></script>
		<script src="js/multiplayer-ui.js"></script>
		<script src="js/game-monitor.js"></script>
		<script src="js/tool-spawner.js"></script>
		<script src="js/game-enhancements.js"></script>
		<script src="js/ultimate-crafting-fix.js"></script>
		<script src="js/complete-crafting-fix.js"></script>
		<script src="js/torch-recipe-consumption-fix.js"></script>
		<script src="js/inventory-reset-fix.js"></script>
		<script src="js/inventory-persistence-fix.js"></script>
		<script src="js/inventory-visibility-fix.js"></script>
		<script src="js/inventory-tooltips.js"></script>
		<script src="js/crafting-result-tooltips.js"></script>
		<script src="js/crafting-click-fix.js"></script>
		<script src="js/ui-keyboard-control.js"></script>
		<script src="js/ui-zindex-fix.js"></script>
		<script src="js/inventory-tooltips.js"></script>
		<script src="js/fullscreen-manager.js"></script>
		<script src="js/settings-menu.js"></script>
		<script src="js/texture-loader.js"></script>
		<script src="js/texture-renderer.js"></script>
		<script src="js/inventory-texture-support.js"></script>
	</body>
</html>
